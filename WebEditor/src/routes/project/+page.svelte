<script lang="ts" ✂prettier:content✂="CglpbXBvcnQgeyBwYWdlIH0gZnJvbSAnJGFwcC9zdG9yZXMnOwoJaW1wb3J0IFRleHRJbnB1dCBmcm9tICckbGliL2Zvcm1zL3RleHRJbnB1dC5zdmVsdGUnOwoJaW1wb3J0IHsgY3JlYXRlUHJvamVjdCwgcHJvamVjdCwgc2F2ZVByb2plY3QgfSBmcm9tICckbGliL3N0b3Jlcy9wcm9qZWN0U3RvcmUuc3ZlbHRlJzsKCWltcG9ydCB7IHRlbXBsYXRlcyB9IGZyb20gJyRsaWIvc3RvcmVzL3RlbXBsYXRlU3RvcmUuc3ZlbHRlJzsKCWltcG9ydCB7IHVzZXJTdG9yZSB9IGZyb20gJyRsaWIvc3RvcmVzL3VzZXJTdG9yZS5zdmVsdGUnOwoJaW1wb3J0IHsgZ2V0TW9kYWxTdG9yZSwgZ2V0VG9hc3RTdG9yZSwgVGFiLCBUYWJHcm91cCwgdHlwZSBUb2FzdFNldHRpbmdzIH0gZnJvbSAnQHNrZWxldG9ubGFicy9za2VsZXRvbic7CglpbXBvcnQgeyBvbk1vdW50IH0gZnJvbSAnc3ZlbHRlJzsKCWltcG9ydCB7IEljb24sIFNhdmUgfSBmcm9tICdzdmVsdGUtZ29vZ2xlLW1hdGVyaWFsZGVzaWduLWljb25zJzsKCWltcG9ydCBJbWFnZVJlc29sdXRpb25zIGZyb20gJy4vSW1hZ2VSZXNvbHV0aW9ucy5zdmVsdGUnOwoKCWNvbnN0IG1vZGFsU3RvcmUgPSBnZXRNb2RhbFN0b3JlKCk7Cgljb25zdCB0b2FzdFN0b3JlID0gZ2V0VG9hc3RTdG9yZSgpOwoJbGV0IG1vZGUgPSAnZWRpdCc7CgoJJDogd2ViUGFnZVRpdGxlID0gJHByb2plY3QgJiYgJHByb2plY3QucHJvamVjdE5hbWUgPyAnIC0gJyArICRwcm9qZWN0LnByb2plY3ROYW1lIDogJyc7CgoJY29uc3QgdG9hc3Q6IFRvYXN0U2V0dGluZ3MgPSB7CgkJbWVzc2FnZTogJ0xvYWRlZCBwb3N0cycsCgkJYmFja2dyb3VuZDogJ3ZhcmlhbnQtZmlsbGVkLXN1Y2Nlc3MnLAoJCWhpZGVEaXNtaXNzOiB0cnVlCgl9OwoJY29uc3QgZXJyb3JUb2FzdDogVG9hc3RTZXR0aW5ncyA9IHsKCQltZXNzYWdlOiAnRmFpbGVkIHRvIGxvYWQgcG9zdHMnLAoJCWJhY2tncm91bmQ6ICd2YXJpYW50LWZpbGxlZC1lcnJvcicKCX07CgoJLyoqCgkgKiBAdHlwZToge01vZGFsU2V0dGluZ3N9CgkgKi8KCSQ6IGNyZWF0ZU5ld1Byb2plY3RNb2RhbCA9IHsKCQl0eXBlOiAnY29tcG9uZW50JywKCQljb21wb25lbnQ6ICdjcmVhdGVOZXdQcm9qZWN0TW9kYWwnLAoJCW1ldGE6IHsKCQkJbW9kYWxUaXRsZTogJ0NyZWF0ZSBuZXcgcHJvamVjdCcsCgkJCXByb2plY3RUaXRsZTogJHByb2plY3QgPyAkcHJvamVjdC5wcm9qZWN0TmFtZSA6ICcnLAoJCQlkb21haW46ICRwcm9qZWN0ID8gJHByb2plY3QuZG9tYWluIDogJycsCgkJCW9uRm9ybVN1Ym1pdDogKGRvbWFpbjogc3RyaW5nKSA9PiB7CgkJCQlpbml0aWF0ZUNyZWF0ZVByb2plY3QoZG9tYWluKTsKCQkJfQoJCX0KCX07CgoJbGV0IHRhYlNldCA9IDA7CgkkOiBzYXZlRGlzYWJsZWQgPQoJCSRwcm9qZWN0ICYmCgkJKCRwcm9qZWN0LnByb2plY3ROYW1lID09PSB1bmRlZmluZWQgfHwKCQkJJHByb2plY3QucHJvamVjdE5hbWUgPT09ICcnIHx8CgkJCSRwcm9qZWN0LmRvbWFpbiA9PT0gdW5kZWZpbmVkIHx8CgkJCSRwcm9qZWN0LmRvbWFpbiA9PT0gJycpOwoKCW9uTW91bnQoYXN5bmMgKCkgPT4gewoJCWlmICgkdXNlclN0b3JlLmlzTG9nZ2VkSW4oKSkgewoJCQkvLyBpZiB0aGUgcXVlcnkgc3RyaW5nIGNvbnRhaW5zIG1vZGU9bmV3LCBjbGVhciB0aGUgcHJvamVjdCBzdG9yZQoJCQlpZiAoJHBhZ2UudXJsLnNlYXJjaFBhcmFtcy5nZXQoJ21vZGUnKSA9PT0gJ25ldycpIHsKCQkJCXByb2plY3QuY2xlYXIoKTsKCQkJCW1vZGUgPSAnbmV3JzsKCQkJfQoJCX0KCX0pOwoKCWFzeW5jIGZ1bmN0aW9uIGluaXRpYXRlU2F2ZVByb2plY3QoKSB7CgkJY29uc29sZS5kaXIoJHByb2plY3QpOwoJCWlmICghc2F2ZURpc2FibGVkKSB7CgkJCWxldCBzYXZlUmVzdWx0ID0gc2F2ZVByb2plY3QoJHByb2plY3QsICR1c2VyU3RvcmUudG9rZW4hISk7CgkJCXNhdmVSZXN1bHQudGhlbigocikgPT4gewoJCQkJaWYgKHIgaW5zdGFuY2VvZiBFcnJvcikgewoJCQkJCWVycm9yVG9hc3QubWVzc2FnZSA9ICdGYWlsZWQgdG8gc2F2ZSBwcm9qZWN0JzsKCQkJCQl0b2FzdFN0b3JlLnRyaWdnZXIoZXJyb3JUb2FzdCk7CgkJCQl9IGVsc2UgewoJCQkJCXRvYXN0Lm1lc3NhZ2UgPSAnU2F2ZWQgcHJvamVjdCAnICsgJHByb2plY3QucHJvamVjdE5hbWU7CgkJCQkJdG9hc3RTdG9yZS50cmlnZ2VyKHRvYXN0KTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWFzeW5jIGZ1bmN0aW9uIGluaXRpYXRlQ3JlYXRlUHJvamVjdChkb21haW46IHN0cmluZykgewoJCWNvbnNvbGUubG9nKCdpbml0aWF0ZUNyZWF0ZVByb2plY3Q6ICcsIGRvbWFpbik7CgkJbGV0IHNhdmVSZXN1bHQgPSBjcmVhdGVQcm9qZWN0KCRwcm9qZWN0LCAkdXNlclN0b3JlLnRva2VuISEpOwoJCXNhdmVSZXN1bHQudGhlbigocikgPT4gewoJCQlpZiAociBpbnN0YW5jZW9mIEVycm9yKSB7CgkJCQljb25zb2xlLmRpcihyKTsKCQkJCWVycm9yVG9hc3QubWVzc2FnZSA9IHIubWVzc2FnZTsKCQkJCXRvYXN0U3RvcmUudHJpZ2dlcihlcnJvclRvYXN0KTsKCQkJfSBlbHNlIHsKCQkJCXRvYXN0Lm1lc3NhZ2UgPSAnU2F2ZWQgcHJvamVjdCAnICsgJHByb2plY3QucHJvamVjdE5hbWU7CgkJCQl0b2FzdFN0b3JlLnRyaWdnZXIodG9hc3QpOwoJCQkJbW9kZSA9ICdlZGl0JzsKCQkJfQoJCX0pOwoJfQoKCWNvbnN0IHByb2plY3RVbnN1YiA9IHByb2plY3Quc3Vic2NyaWJlKCh2YWx1ZSkgPT4gewoJCWlmICh2YWx1ZSkgewoJCQkvLyBkbyBub3RoaW5nCgkJfQoJfSk7Cg==">{}</script>

<svelte:head>
	<title>Cantilever: Project Settings {webPageTitle}</title>
</svelte:head>

<div class="flex flex-col grow mt-2 container">
	{#if $userStore.isLoggedIn()}
		<div class="flex flex-col justify-center w-full">
			{#if $project}
				<h3 class="h3 mb-2 text-center">
					{#if mode === 'new'}Create new project{:else}{$project.projectName} settings{/if}
				</h3>
				<div class="flex flex-row justify-end">
					<div class="btn-group variant-filled" role="group">
						<button
							on:click={(e) => {
								if (mode === 'new') {
									modalStore.trigger(createNewProjectModal);
								} else {
									initiateSaveProject();
								}
							}}
							disabled={saveDisabled}
							title="Save project settings"
							class="variant-filled-primary">Save<Icon icon={Save} /></button>
					</div>
				</div>

				<div class="grid grid-cols-6 gap-6">
					<div class="col-span-6 sm:col-span-6 lg:col-span-4">
						<TextInput
							label="Project name"
							name="project-name"
							bind:value={$project.projectName}
							required />
					</div>
					<div class="col-span-6 sm:col-span-6 lg:col-span-2">
						<TextInput
							label="Project author"
							name="project-author"
							bind:value={$project.author}
							required />
					</div>
				</div>
				<div class="grid grid-cols-6 gap-6">
					<div class="col-span-6 sm:col-span-6 lg:col-span-2">
						<TextInput
							label="Default date format"
							name="date-format"
							bind:value={$project.dateFormat}
							required />
					</div>
					<div class="col-span-6 sm:col-span-6 lg:col-span-2">
						<TextInput
							label="Default date &amp; time format"
							name="date-time-format"
							bind:value={$project.dateTimeFormat}
							required />
					</div>
					<div class="col-span-6 sm:col-span-6 lg:col-span-2">
						<TextInput
							label="Website domain"
							name="domain"
							readonly={mode === 'edit'}
							bind:value={$project.domain}
							required />
					</div>
				</div>

				<TabGroup justify="justify-center" class="mt-4">
					<Tab bind:group={tabSet} name="resolutions" value={0}
						>Resolutions ({$project.imageResolutions.size})</Tab>
					<Tab bind:group={tabSet} name="attributes" value={1}>Custom attributes</Tab>
					<!-- Tab Panels --->
					<svelte:fragment slot="panel">
						{#if tabSet === 0}
							<ImageResolutions />
						{:else if tabSet === 1}
							(custom attribute panel contents)
						{/if}
					</svelte:fragment>
				</TabGroup>

				<!-- Debugging stores -->
				<div class="grid grid-cols-6 gap-6">
					<div class="col-span-6 sm:col-span-6 lg:col-span-2">
						<h4 class="h4">Project Store</h4>
						<pre class="text-xs">{JSON.stringify($project, null, 2)}</pre>
					</div>
					<div class="col-span-6 sm:col-span-6 lg:col-span-2">
						<h4 class="h4">Template Store</h4>
						<pre class="text-xs">{JSON.stringify($templates, null, 2)}</pre>
					</div>
				</div>
			{:else}
				<p class="placeholder">Loading project...</p>
			{/if}
		</div>
	{:else}
		<p class="text-error-500">Please log in to continue</p>
	{/if}
</div>
