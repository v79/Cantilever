<script lang="ts" ✂prettier:content✂="CglpbXBvcnQgewoJCUFwcEJhciwKCQlBcHBSYWlsLAoJCUFwcFJhaWxBbmNob3IsCgkJQXBwU2hlbGwsCgkJZ2V0VG9hc3RTdG9yZSwKCQlpbml0aWFsaXplU3RvcmVzLAoJCUxpc3RCb3gsCgkJTGlzdEJveEl0ZW0sCgkJTW9kYWwsCgkJdHlwZSBNb2RhbENvbXBvbmVudCwKCQlwb3B1cCwKCQl0eXBlIFBvcHVwU2V0dGluZ3MsCgkJc3RvcmVQb3B1cCwKCQlUb2FzdCwKCQl0eXBlIFRvYXN0U2V0dGluZ3MKCX0gZnJvbSAnQHNrZWxldG9ubGFicy9za2VsZXRvbic7CglpbXBvcnQgJy4uL2FwcC5wb3N0Y3NzJzsKCS8vIEhpZ2hsaWdodCBKUwoJaW1wb3J0IHsgcGFnZSB9IGZyb20gJyRhcHAvc3RvcmVzJzsKCWltcG9ydCBMb2dpbkF2YXRhciBmcm9tICckbGliL2NvbXBvbmVudHMvTG9naW5BdmF0YXIuc3ZlbHRlJzsKCWltcG9ydCB7IHVzZXJTdG9yZSB9IGZyb20gJyRsaWIvc3RvcmVzL3VzZXJTdG9yZS5zdmVsdGUnOwoJaW1wb3J0IHsgYXJyb3csIGF1dG9VcGRhdGUsIGNvbXB1dGVQb3NpdGlvbiwgZmxpcCwgb2Zmc2V0LCBzaGlmdCB9IGZyb20gJ0BmbG9hdGluZy11aS9kb20nOwoJaW1wb3J0ICdoaWdobGlnaHQuanMvc3R5bGVzL2dpdGh1Yi1kYXJrLmNzcyc7CglpbXBvcnQgewoJCUFydGljbGUsCgkJQ2xlYXIsCgkJRGF0YXNldF9saW5rZWQsCgkJRG9jdW1lbnRfc2Nhbm5lciwKCQlGZWVkLAoJCUhvbWUsCgkJSWNvbiwKCQlQZXJtX21lZGlhLAoJCVNldHRpbmdzX2FwcGxpY2F0aW9ucywKCQlTeW5jCgl9IGZyb20gJ3N2ZWx0ZS1nb29nbGUtbWF0ZXJpYWxkZXNpZ24taWNvbnMnOwoJaW1wb3J0IHsgYmVmb3JlTmF2aWdhdGUgfSBmcm9tICckYXBwL25hdmlnYXRpb24nOwoJaW1wb3J0IENvbmZpcm1EZWxldGVNb2RhbCBmcm9tICckbGliL21vZGFscy9jb25maXJtRGVsZXRlTW9kYWwuc3ZlbHRlJzsKCWltcG9ydCBDcmVhdGVOZXdGb2xkZXJNb2RhbCBmcm9tICckbGliL21vZGFscy9jcmVhdGVOZXdGb2xkZXJNb2RhbC5zdmVsdGUnOwoJaW1wb3J0IENyZWF0ZU5ld1BhZ2VNb2RhbCBmcm9tICckbGliL21vZGFscy9jcmVhdGVOZXdQYWdlTW9kYWwuc3ZlbHRlJzsKCWltcG9ydCBDcmVhdGVOZXdQb3N0TW9kYWwgZnJvbSAnJGxpYi9tb2RhbHMvY3JlYXRlTmV3UG9zdE1vZGFsLnN2ZWx0ZSc7CglpbXBvcnQgU2F2ZU5ld1BhZ2VNb2RhbCBmcm9tICckbGliL21vZGFscy9zYXZlTmV3UGFnZU1vZGFsLnN2ZWx0ZSc7CglpbXBvcnQgU2F2ZU5ld1Bvc3RNb2RhbCBmcm9tICckbGliL21vZGFscy9zYXZlTmV3UG9zdE1vZGFsLnN2ZWx0ZSc7CglpbXBvcnQgU2F2ZU5ld1Byb2plY3RNb2RhbCBmcm9tICckbGliL21vZGFscy9zYXZlTmV3UHJvamVjdE1vZGFsLnN2ZWx0ZSc7CglpbXBvcnQgU2F2ZU5ld1RlbXBsYXRlTW9kYWwgZnJvbSAnJGxpYi9tb2RhbHMvc2F2ZU5ld1RlbXBsYXRlTW9kYWwuc3ZlbHRlJzsKCWltcG9ydCBTd2l0Y2hJbmRleFBhZ2VNb2RhbCBmcm9tICckbGliL21vZGFscy9zd2l0Y2hJbmRleFBhZ2VNb2RhbC5zdmVsdGUnOwoJaW1wb3J0IHsgaGFuZGxlYmFycywgbWFya2Rvd25TdG9yZSB9IGZyb20gJyRsaWIvc3RvcmVzL2NvbnRlbnRTdG9yZS5zdmVsdGUnOwoJaW1wb3J0IHsgcHJvamVjdCB9IGZyb20gJyRsaWIvc3RvcmVzL3Byb2plY3RTdG9yZS5zdmVsdGUnOwoJaW1wb3J0IHsgY2xlYXJDYWNoZSwgcmVidWlsZEFsbE1ldGFkYXRhLCByZWJ1aWxkQWxsUGFnZXMsIHJlYnVpbGRBbGxQb3N0cyB9IGZyb20gJyRsaWIvc3RvcmVzL3JlZ2VuU3RvcmUuc3ZlbHRlJzsKCWltcG9ydCBTcGlubmVyU3RvcmUsIHsgc3Bpbm5lciB9IGZyb20gJyRsaWIvc3RvcmVzL3NwaW5uZXJTdG9yZS5zdmVsdGUnOwoJaW1wb3J0IHsgb25Nb3VudCB9IGZyb20gJ3N2ZWx0ZSc7CglpbXBvcnQgRXhwYW5kTW9yZSBmcm9tICdzdmVsdGUtZ29vZ2xlLW1hdGVyaWFsZGVzaWduLWljb25zL0V4cGFuZF9tb3JlLnN2ZWx0ZSc7CglpbXBvcnQgeyBQVUJMSUNfQ0FOVElMRVZFUl9BUElfVVJMIH0gZnJvbSAnJGVudi9zdGF0aWMvcHVibGljJzsKCglzdG9yZVBvcHVwLnNldCh7IGNvbXB1dGVQb3NpdGlvbiwgYXV0b1VwZGF0ZSwgZmxpcCwgc2hpZnQsIG9mZnNldCwgYXJyb3cgfSk7CgoJY29uc3QgbW9kYWxSZWdpc3RyeTogUmVjb3JkPHN0cmluZywgTW9kYWxDb21wb25lbnQ+ID0gewoJCWNvbmZpcm1EZWxldGVNb2RhbDogeyByZWY6IENvbmZpcm1EZWxldGVNb2RhbCB9LAoJCXNhdmVOZXdQb3N0TW9kYWw6IHsgcmVmOiBTYXZlTmV3UG9zdE1vZGFsIH0sCgkJc2F2ZU5ld1RlbXBsYXRlTW9kYWw6IHsgcmVmOiBTYXZlTmV3VGVtcGxhdGVNb2RhbCB9LAoJCWNyZWF0ZU5ld1BhZ2VNb2RhbDogeyByZWY6IENyZWF0ZU5ld1BhZ2VNb2RhbCB9LAoJCWNyZWF0ZU5ld0ZvbGRlck1vZGFsOiB7IHJlZjogQ3JlYXRlTmV3Rm9sZGVyTW9kYWwgfSwKCQlzd2l0Y2hJbmRleFBhZ2VNb2RhbDogeyByZWY6IFN3aXRjaEluZGV4UGFnZU1vZGFsIH0sCgkJc2F2ZU5ld1BhZ2VNb2RhbDogeyByZWY6IFNhdmVOZXdQYWdlTW9kYWwgfSwKCQljcmVhdGVOZXdQcm9qZWN0TW9kYWw6IHsgcmVmOiBTYXZlTmV3UHJvamVjdE1vZGFsIH0sCgkJY3JlYXRlTmV3UG9zdE1vZGFsOiB7IHJlZjogQ3JlYXRlTmV3UG9zdE1vZGFsIH0KCX07Cglpbml0aWFsaXplU3RvcmVzKCk7CgoJY29uc3QgdG9hc3RTdG9yZSA9IGdldFRvYXN0U3RvcmUoKTsKCWNvbnN0IHRvYXN0OiBUb2FzdFNldHRpbmdzID0gewoJCW1lc3NhZ2U6ICdMb2FkZWQgcG9zdHMnLAoJCWJhY2tncm91bmQ6ICd2YXJpYW50LWZpbGxlZC1zdWNjZXNzJywKCQloaWRlRGlzbWlzczogdHJ1ZQoJfTsKCWNvbnN0IGVycm9yVG9hc3Q6IFRvYXN0U2V0dGluZ3MgPSB7CgkJbWVzc2FnZTogJ0ZhaWxlZCB0byBsb2FkIHBvc3RzJywKCQliYWNrZ3JvdW5kOiAndmFyaWFudC1maWxsZWQtZXJyb3InCgl9OwoKCSQ6IGxvZ2dlZEluID0gJHVzZXJTdG9yZS5pc0xvZ2dlZEluKCk7CgoJZXhwb3J0IGNvbnN0IHdhcm1UaW1lciA9IDYwICogNDAwMDsKCglsZXQgcmVnZW5Db21ib1ZhbHVlID0gJ1JlZ2VuZXJhdGUuLi4nOwoJY29uc3QgcmVnZW5Qb3B1cDogUG9wdXBTZXR0aW5ncyA9IHsKCQlldmVudDogJ2NsaWNrJywKCQl0YXJnZXQ6ICdyZWdlblBvcHVwJywKCQlwbGFjZW1lbnQ6ICdib3R0b20nLAoJCWNsb3NlUXVlcnk6ICcubGlzdGJveC1pdGVtJwoJfTsKCglvbk1vdW50KCgpID0+IHsKCQlhc3luYyBmdW5jdGlvbiB3YXJtKCkgewoJCQkvLyBhdHRlbXB0IHRvIHdhcm0gdGhlIGxhbWJkYSBieSBjYWxsaW5nIC93YXJtICgvcGluZyBpcyByZXNlcnZlZCBieSBBUEkgR2F0ZXdheSkKCQkJY29uc29sZS5sb2coJ0tlZXBpbmcgbGFtYmRhIHdhcm0uLi4nKTsKCQkJZmV0Y2goUFVCTElDX0NBTlRJTEVWRVJfQVBJX1VSTCArICcvd2FybScsIHsKCQkJCW1vZGU6ICduby1jb3JzJywKCQkJCWhlYWRlcnM6IHsKCQkJCQlBY2NlcHQ6ICd0ZXh0L3BsYWluJwoJCQkJfQoJCQl9KTsKCQl9CgoJCWNvbnN0IGludGVydmFsID0gc2V0SW50ZXJ2YWwod2FybSwgd2FybVRpbWVyKTsKCQl3YXJtKCk7CgkJcmV0dXJuICgpID0+IGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpOwoJfSk7CgoJYmVmb3JlTmF2aWdhdGUoKCkgPT4gewoJCS8vIGNsZWFyIGNvbnRlbnQgc3RvcmVzIG9uIG5hdmlnYXRpb24KCQltYXJrZG93blN0b3JlLmNsZWFyKCk7CgkJaGFuZGxlYmFycy5jbGVhcigpOwoJfSk7CgoJYXN5bmMgZnVuY3Rpb24gaW5pdGlhdGVNZXRhZGF0YVJlYnVpbGQoKSB7CgkJaWYgKCRwcm9qZWN0ICYmICRwcm9qZWN0LmRvbWFpbikgewoJCQlzcGlubmVyLnNob3coJ1JlYnVpbGRpbmcgbWV0YWRhdGEuLi4nKTsKCQkJbGV0IHJlc3BvbnNlID0gcmVidWlsZEFsbE1ldGFkYXRhKCR1c2VyU3RvcmUudG9rZW4hISwgJHByb2plY3QuZG9tYWluKTsKCQkJcmVzcG9uc2UudGhlbigoZGF0YSkgPT4gewoJCQkJdG9hc3QubWVzc2FnZSA9IGRhdGE7CgkJCQl0b2FzdFN0b3JlLnRyaWdnZXIodG9hc3QpOwoJCQkJc3Bpbm5lci5oaWRlKCk7CgkJCQlyZWdlbkNvbWJvVmFsdWUgPSAnUmVnZW5lcmF0ZS4uLic7CgkJCX0pOwoJCX0KCX0KCWFzeW5jIGZ1bmN0aW9uIGluaXRpYXRlUG9zdHNSZWJ1aWxkKCkgewoJCWlmICgkcHJvamVjdCAmJiAkcHJvamVjdC5kb21haW4pIHsKCQkJc3Bpbm5lci5zaG93KCdSZWJ1aWxkaW5nIHBvc3RzLi4uJyk7CgkJCWxldCByZXNwb25zZSA9IHJlYnVpbGRBbGxQb3N0cygkdXNlclN0b3JlLnRva2VuISEsICRwcm9qZWN0LmRvbWFpbik7CgkJCXJlc3BvbnNlLnRoZW4oKGRhdGEpID0+IHsKCQkJCXRvYXN0Lm1lc3NhZ2UgPSBkYXRhOwoJCQkJdG9hc3RTdG9yZS50cmlnZ2VyKHRvYXN0KTsKCQkJCXNwaW5uZXIuaGlkZSgpOwoJCQkJcmVnZW5Db21ib1ZhbHVlID0gJ1JlZ2VuZXJhdGUuLi4nOwoJCQl9KTsKCQl9Cgl9Cglhc3luYyBmdW5jdGlvbiBpbml0aWF0ZVBhZ2VzUmVidWlsZCgpIHsKCQlpZiAoJHByb2plY3QgJiYgJHByb2plY3QuZG9tYWluKSB7CgkJCXNwaW5uZXIuc2hvdygnUmVidWlsZGluZyBwYWdlcy4uLicpOwoJCQlsZXQgcmVzcG9uc2UgPSByZWJ1aWxkQWxsUGFnZXMoJHVzZXJTdG9yZS50b2tlbiEhLCAkcHJvamVjdC5kb21haW4pOwoJCQlyZXNwb25zZS50aGVuKChkYXRhKSA9PiB7CgkJCQl0b2FzdC5tZXNzYWdlID0gZGF0YTsKCQkJCXRvYXN0U3RvcmUudHJpZ2dlcih0b2FzdCk7CgkJCQlzcGlubmVyLmhpZGUoKTsKCQkJCXJlZ2VuQ29tYm9WYWx1ZSA9ICdSZWdlbmVyYXRlLi4uJzsKCQkJfSk7CgkJfQoJfQoKCWFzeW5jIGZ1bmN0aW9uIGluaXRpYXRlSW1hZ2VSZXNSZWJ1aWxkKCkgewoJCWNvbnNvbGUubG9nKCdSZWJ1aWxkaW5nIGltYWdlIHJlc29sdXRpb25zIC0gbm90IHlldCBpbXBsZW1lbnRlZCcpOwoJfQoKCWFzeW5jIGZ1bmN0aW9uIGNsZWFyRnJhZ21lbnRDYWNoZSgpIHsKCQlpZiAoJHByb2plY3QgJiYgJHByb2plY3QuZG9tYWluKSB7CgkJCXNwaW5uZXIuc2hvdygnQ2xlYXJpbmcgZnJhZ21lbnQgY2FjaGUuLi4nKTsKCQkJbGV0IHJlc3BvbnNlID0gY2xlYXJDYWNoZSgnZnJhZ21lbnRzJywgJHVzZXJTdG9yZS50b2tlbiEhLCAkcHJvamVjdC5kb21haW4pOwoJCQlyZXNwb25zZQoJCQkJLnRoZW4oKGRhdGEpID0+IHsKCQkJCQl0b2FzdC5tZXNzYWdlID0gZGF0YTsKCQkJCQl0b2FzdFN0b3JlLnRyaWdnZXIodG9hc3QpOwoJCQkJCXNwaW5uZXIuaGlkZSgpOwoJCQkJCXJlZ2VuQ29tYm9WYWx1ZSA9ICdSZWdlbmVyYXRlLi4uJzsKCQkJCX0pCgkJCQkuY2F0Y2goKGVycm9yKSA9PiB7CgkJCQkJZXJyb3JUb2FzdC5tZXNzYWdlID0gZXJyb3I7CgkJCQkJdG9hc3RTdG9yZS50cmlnZ2VyKGVycm9yVG9hc3QpOwoJCQkJCXNwaW5uZXIuaGlkZSgpOwoJCQkJCXJlZ2VuQ29tYm9WYWx1ZSA9ICdSZWdlbmVyYXRlLi4uJzsKCQkJCX0pOwoJCX0KCX0KCglhc3luYyBmdW5jdGlvbiBjbGVhckltYWdlQ2FjaGUoKSB7CgkJY29uc29sZS5sb2coJ0NsZWFyaW5nIGltYWdlIGNhY2hlIC0gbm90IHlldCBpbXBsZW1lbnRlZCcpOwoJfQo=">{}</script>

<!-- Single Modal Container -->
<Modal components={modalRegistry} />

<!-- Single Toast Container -->
<Toast position="t" padding="p-2" />

<!-- App Shell -->
<AppShell>
	<svelte:fragment slot="header">
		<!-- App Bar -->
		<AppBar gridColumns="grid-cols-3" slotDefault="place-self-center" slotTrail="place-content-end">
			<svelte:fragment slot="lead">
				<strong class="text-xl">Cantilever v0.1.1</strong>

				{#if loggedIn && $project && $project.domain}
					<button
						class="btn btn-sm variant-ghost-primary w-48 justify-between"
						use:popup={regenPopup}>
						<Icon icon={Sync} size={24} />
						<span class="capitalize">{regenComboValue ?? 'Trigger'}</span>
						<Icon icon={ExpandMore} size={24} />
					</button>
				{/if}
			</svelte:fragment>
			<div class="">
				{#if $project}
					<h2 class="h2">{$project.projectName}</h2>
				{:else}
					<h3 class="h3"><em>No project</em></h3>
				{/if}
			</div>
			<svelte:fragment slot="headline">
				<SpinnerStore />
			</svelte:fragment>
			<svelte:fragment slot="trail">
				<LoginAvatar />
			</svelte:fragment>
		</AppBar>
	</svelte:fragment>

	<!-- Navigation Rail -->
	<svelte:fragment slot="sidebarLeft">
		<!-- Hidden below Tailwind's large breakpoint -->

		{#if loggedIn}
			<AppRail>
				<div data-sveltekit-preload-data="false">
					<AppRailAnchor href="/" selected={$page.url.pathname === '/'} title="Home">
						<svelte:fragment slot="lead"
							><Icon icon={Home} size={32} variation="outlined" /></svelte:fragment>
						<span>Home</span>
					</AppRailAnchor>
					{#if $project && $project.projectName !== ''}
						<AppRailAnchor
							href="/project"
							selected={$page.url.pathname === '/project'}
							title="Project">
							<svelte:fragment slot="lead"
								><Icon
									icon={Settings_applications}
									size={32}
									variation="outlined" /></svelte:fragment>
							<span>Project</span>
						</AppRailAnchor>

						<AppRailAnchor href="/posts" selected={$page.url.pathname === '/posts'} title="Posts">
							<svelte:fragment slot="lead">
								<Icon icon={Feed} size={32} variation="outlined" />
							</svelte:fragment>

							<span>Posts</span>
						</AppRailAnchor>

						<AppRailAnchor href="/pages" selected={$page.url.pathname === '/pages'} title="Pages">
							<svelte:fragment slot="lead"
								><Icon icon={Article} size={32} variation="outlined" /></svelte:fragment>
							<span>Pages</span>
						</AppRailAnchor>

						<AppRailAnchor href="/media" selected={$page.url.pathname === '/media'} title="Media">
							<svelte:fragment slot="lead"
								><Icon icon={Perm_media} size={32} variation="outlined" /></svelte:fragment>
							<span>Media</span>
						</AppRailAnchor>

						<AppRailAnchor
							href="/templates"
							title="Templates"
							selected={$page.url.pathname === '/templates'}>
							<svelte:fragment slot="lead">
								<!-- TODO: this badge might be a nice way of indicating that there are ungenerated changes? -->
								<div class="relative inline-block">
									<span class="badge-icon variant-filled-error absolute -bottom-0 -right-0 z-10"
										>2</span>
									<Icon icon={Document_scanner} size={32} variation="outlined" />
								</div></svelte:fragment>
							<span>Templates</span>
						</AppRailAnchor>
					{/if}
				</div>
			</AppRail>
		{/if}
	</svelte:fragment>

	<!-- Page Route Content -->
	<div class="container h-full mx-auto flex">
		<slot />
	</div>
</AppShell>

<div class="card w-56 shadow-xl py-2 variant-glass-secondary z-20" data-popup="regenPopup">
	<ListBox rounded="rounded-none">
		<ListBoxItem
			bind:group={regenComboValue}
			name="metadata"
			value="metadata"
			on:click={(e) => {
				initiateMetadataRebuild();
			}}
			><svelte:fragment slot="lead"><Icon icon={Dataset_linked} /></svelte:fragment>Project metadata</ListBoxItem>
		<ListBoxItem
			bind:group={regenComboValue}
			name="posts"
			value="posts"
			on:click={(e) => {
				initiatePostsRebuild();
			}}>
			<svelte:fragment slot="lead"><Icon icon={Feed} /></svelte:fragment>Posts</ListBoxItem>
		<ListBoxItem
			bind:group={regenComboValue}
			name="pages"
			value="pages"
			on:click={(e) => {
				initiatePagesRebuild();
			}}>
			<svelte:fragment slot="lead"><Icon icon={Article} /></svelte:fragment>Pages</ListBoxItem>
		<ListBoxItem
			bind:group={regenComboValue}
			name="images"
			value="images"
			on:click={(e) => {
				initiateImageResRebuild();
			}}>
			<svelte:fragment slot="lead"
				><Icon icon={Perm_media} color="text-secondary-200" /></svelte:fragment
			><span class="text-secondary-200"><em>Images</em></span></ListBoxItem>
	</ListBox>
	<hr class="border-t-2 border-surface-100-800-token" />
	<ListBox rounded="rounded-none">
		<ListBoxItem
			bind:group={regenComboValue}
			name="clearFragments"
			value="clearFragments"
			on:click={(e) => {
				clearFragmentCache();
			}}
			><svelte:fragment slot="lead"><Icon icon={Clear} /></svelte:fragment>Clear fragments</ListBoxItem>
		<ListBoxItem
			bind:group={regenComboValue}
			name="clearImages"
			value="clearImages"
			on:click={(e) => {
				clearImageCache();
			}}
			><svelte:fragment slot="lead"><Icon icon={Clear} /></svelte:fragment>Clear images</ListBoxItem>
	</ListBox>
	<div class="arrow bg-surface-100-800-token" />
</div>
